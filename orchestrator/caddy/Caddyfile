{$DOMAIN:circlescorner.xyz} {
    handle /health {
        respond "OK" 200
    }

    handle /setup* {
        reverse_proxy control-panel:8000
    }

    handle /login* {
        reverse_proxy control-panel:8000
    }

    handle /static/* {
        reverse_proxy control-panel:8000
    }

    handle /auth/verify {
        reverse_proxy control-panel:8000
    }

    handle /terminal* {
        forward_auth control-panel:8000 {
            uri /auth/verify
            copy_headers X-User
        }
        reverse_proxy ttyd:7681
    }

    handle /api/* {
        forward_auth control-panel:8000 {
            uri /auth/verify
            copy_headers X-User
        }
        reverse_proxy control-panel:8000
    }

    handle /* {
        forward_auth control-panel:8000 {
            uri /auth/verify
            copy_headers X-User
        }
        reverse_proxy control-panel:8000
    }

    header {
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
    }

    log {
        output stdout
    }
}
